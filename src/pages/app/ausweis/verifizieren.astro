---
import Site from "../../../layouts/Site.astro";
import { APP } from "../../../config/app";
---

<Site title={`Ausweis prüfen • ${APP.name}`} description="Mitgliedsausweis verifizieren" robots="noindex">
  <div id="scanVerdictOverlay" class="scan-verdict" hidden aria-live="assertive" aria-atomic="true">
    <div class="scan-verdict__icon" id="scanVerdictIcon" aria-hidden="true">✓</div>
    <div class="scan-verdict__title" id="scanVerdictTitle">GÜLTIG</div>
    <div class="scan-verdict__meta" id="scanVerdictMeta"></div>
  </div>

  <section class="card" style="max-width:900px;margin:0 auto;">
    <div class="card__body">
      <h1>Scanner</h1>
      <p class="small">Nur für Vorstand/Admin. Bitte Ausweis in das Scanfenster halten.</p>
      <p id="memberCardVerifyMsg" class="small" aria-live="polite"></p>

      <article class="card">
        <div class="card__body">
          <h3>Kontrolleur</h3>
          <p class="small">Name: <strong id="verifyControllerName">-</strong></p>
          <p class="small">Kontrolleur-ID: <strong id="verifyControllerId">-</strong></p>
        </div>
      </article>

      <article class="card" style="margin-top:12px;">
        <div class="card__body">
          <h3>Ausweis scannen</h3>
          <div class="scan-stage">
            <video id="cardVerifyVideo" playsinline></video>
            <div class="scan-stage__frame" aria-hidden="true"></div>
          </div>
          <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;">
            <button id="cardVerifyScanStart" type="button" class="feed-btn">Scanner starten</button>
            <button id="cardVerifyScanStop" type="button" class="feed-btn feed-btn--ghost">Scanner stoppen</button>
          </div>
          <p id="scanInlineStatus" class="scan-inline-status" aria-live="polite">Bereit für Scan</p>
          <p class="small">Falls Kamera nicht verfügbar ist, erlaube den Zugriff im Browser.</p>
        </div>
      </article>

      <article id="cardVerifyResult" class="card" style="margin-top:12px;">
        <div class="card__body">
          <p class="small">Noch keine Prüfung durchgeführt.</p>
        </div>
      </article>
    </div>
  </section>

  <script src="/js/member-card-verify.js" defer></script>

  <style>
    .scan-verdict[hidden] {
      display: none !important;
    }
    .scan-verdict {
      position: fixed;
      inset: 0;
      z-index: 2000;
      display: grid;
      place-items: center;
      text-align: center;
      color: #fff;
      background: rgba(5, 100, 44, 0.94);
      padding: 24px;
    }
    .scan-verdict.is-invalid {
      background: rgba(146, 21, 21, 0.94);
    }
    .scan-verdict__icon {
      width: min(28vw, 180px);
      height: min(28vw, 180px);
      border-radius: 50%;
      border: 4px solid rgba(255, 255, 255, 0.95);
      display: grid;
      place-items: center;
      font-size: clamp(3rem, 8vw, 5.5rem);
      font-weight: 900;
      line-height: 1;
      margin-bottom: 16px;
    }
    .scan-verdict__title {
      font-size: clamp(2rem, 7vw, 4.25rem);
      font-weight: 900;
      letter-spacing: 0.08em;
    }
    .scan-verdict__meta {
      margin-top: 12px;
      font-size: clamp(1rem, 2.6vw, 1.5rem);
      opacity: 0.95;
    }
    .scan-stage {
      position: relative;
      border: 1px solid var(--line);
      border-radius: 12px;
      overflow: hidden;
      background: #000;
      aspect-ratio: 4 / 3;
      max-height: 70vh;
    }
    .scan-stage video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .scan-stage__frame {
      position: absolute;
      left: 50%;
      top: 50%;
      width: min(62vw, 320px);
      height: min(62vw, 320px);
      transform: translate(-50%, -50%);
      border: 3px solid rgba(255, 255, 255, 0.95);
      border-radius: 14px;
      box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.36);
      pointer-events: none;
    }
    .scan-inline-status {
      margin: 8px 0 0 0;
      font-size: 0.9rem;
      color: #9ca7b8;
    }
    .scan-inline-status.is-valid {
      color: #5ad48b;
    }
    .scan-inline-status.is-invalid {
      color: #ff7c7c;
    }
    @media (max-width: 760px) {
      .scan-stage__frame {
        width: min(74vw, 320px);
        height: min(74vw, 320px);
      }
    }
  </style>
</Site>
